<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mappa Completa Clienti Ompra</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Arial, sans-serif; }
        #map { height: 100vh; width: 100%; }
        
        /* Box Informazioni */
        .info-panel {
            position: absolute;
            top: 20px; left: 20px; z-index: 1000;
            background: white; padding: 15px;
            border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border-left: 5px solid #2e7d32;
            min-width: 200px;
        }
        .close-btn {
            position: absolute; top: 5px; right: 10px;
            font-size: 20px; font-weight: bold; color: #888; cursor: pointer;
        }
        .info-panel h2 { margin: 0 0 5px; font-size: 18px; color: #1b5e20; }
        .info-panel p { margin: 0; font-size: 14px; color: #555; }
        
        /* Legenda */
        .legend {
            position: absolute; bottom: 20px; right: 10px; z-index: 1000;
            background: rgba(255, 255, 255, 0.95); padding: 10px;
            border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.2); font-size: 12px;
        }
        .dot { height: 10px; width: 10px; display: inline-block; border-radius: 50%; margin-right: 5px; }
    </style>
</head>
<body>

    <div class="info-panel" id="infoBox">
        <span class="close-btn" onclick="document.getElementById('infoBox').style.display='none'">&times;</span>
        <h2>Ompra Srl</h2>
        <p>Analisi Completa Territorio</p>
        <hr style="border: 0; border-top: 1px solid #eee; margin: 8px 0;">
        <p><b>Raggio:</b> 50 km</p>
        <p>Visualizzati tutti i comuni<br>con almeno 1 contatto.</p>
    </div>

    <div class="legend">
        <div><span class="dot" style="background:#d32f2f;"></span> Sede</div>
        <div><span class="dot" style="background:#1b5e20;"></span> > 10 Clienti</div>
        <div><span class="dot" style="background:#4caf50;"></span> 3-10 Clienti</div>
        <div><span class="dot" style="background:#bdbdbd; border:1px solid #999;"></span> 1-2 Clienti</div>
    </div>

    <div id="map"></div>

    <script>
        const latOmpra = 45.6883;
        const lonOmpra = 12.3831;

        var map = L.map('map').setView([latOmpra, lonOmpra], 9);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO',
            maxZoom: 19
        }).addTo(map);

        // Cerchio 50km
        L.circle([latOmpra, lonOmpra], {
            color: '#2e7d32', fillColor: '#4caf50', fillOpacity: 0.05, weight: 1, radius: 50000 
        }).addTo(map);

        // --- DATASET COMPLETO (Estratto dal tuo file Excel) ---
        const comuni = [
            { nome: "OMPRA Sede", lat: 45.6883, lon: 12.3831, val: 100, tipo: "sede" },
            { nome: "San Biagio di Callalta", lat: 45.6867, lon: 12.3833, val: 15 },
            { nome: "Monastier di Treviso", lat: 45.6500, lon: 12.4333, val: 1 },
            { nome: "Breda di Piave", lat: 45.7136, lon: 12.3276, val: 11 },
            { nome: "Roncade", lat: 45.6269, lon: 12.3739, val: 12 },
            { nome: "Silea", lat: 45.6583, lon: 12.2964, val: 5 },
            { nome: "Carbonera", lat: 45.6833, lon: 12.2833, val: 9 },
            { nome: "Maserada sul Piave", lat: 45.7500, lon: 12.3167, val: 8 },
            { nome: "Casier", lat: 45.6122, lon: 12.2936, val: 5 },
            { nome: "Cimadolmo", lat: 45.7833, lon: 12.3667, val: 1 },
            { nome: "Salgareda", lat: 45.7000, lon: 12.4833, val: 1 },
            { nome: "Casale sul Sile", lat: 45.6000, lon: 12.3333, val: 7 },
            { nome: "Treviso", lat: 45.6669, lon: 12.2423, val: 23 },
            { nome: "Quarto d'Altino", lat: 45.5833, lon: 12.3667, val: 1 },
            { nome: "Fossalta di Piave", lat: 45.6500, lon: 12.5167, val: 1 },
            { nome: "Villorba", lat: 45.7333, lon: 12.2333, val: 5 },
            { nome: "Oderzo", lat: 45.7833, lon: 12.4936, val: 1 },
            { nome: "Ponzano Veneto", lat: 45.7222, lon: 12.2222, val: 14 },
            { nome: "Povegliano", lat: 45.7667, lon: 12.2000, val: 1 },
            { nome: "Spresiano", lat: 45.7833, lon: 12.2500, val: 5 },
            { nome: "Preganziol", lat: 45.6000, lon: 12.2333, val: 5 },
            { nome: "San Donà di Piave", lat: 45.6307, lon: 12.5636, val: 9 },
            { nome: "Vazzola", lat: 45.8333, lon: 12.3833, val: 3 },
            { nome: "Musile di Piave", lat: 45.6179, lon: 12.5623, val: 11 },
            { nome: "Marcon", lat: 45.5667, lon: 12.3000, val: 4 },
            { nome: "Paese", lat: 45.6667, lon: 12.1500, val: 3 },
            { nome: "Quinto di Treviso", lat: 45.6500, lon: 12.1667, val: 1 },
            { nome: "Fontanelle", lat: 45.8333, lon: 12.4667, val: 5 },
            { nome: "Chiarano", lat: 45.7333, lon: 12.5833, val: 3 },
            { nome: "Mogliano Veneto", lat: 45.5614, lon: 12.2472, val: 9 },
            { nome: "Mareno di Piave", lat: 45.8500, lon: 12.3500, val: 3 },
            { nome: "Mansuè", lat: 45.8167, lon: 12.5333, val: 2 },
            { nome: "Nervesa della Battaglia", lat: 45.8167, lon: 12.2167, val: 4 },
            { nome: "Ceggia", lat: 45.6833, lon: 12.6333, val: 1 },
            { nome: "Zero Branco", lat: 45.6000, lon: 12.1667, val: 3 },
            { nome: "Santa Lucia di Piave", lat: 45.8500, lon: 12.2833, val: 4 },
            { nome: "Motta di Livenza", lat: 45.7667, lon: 12.6000, val: 2 },
            { nome: "Susegana", lat: 45.8500, lon: 12.2500, val: 2 },
            { nome: "Istrana", lat: 45.6833, lon: 12.1000, val: 2 },
            { nome: "Morgano", lat: 45.6500, lon: 12.1000, val: 1 },
            { nome: "Conegliano", lat: 45.8872, lon: 12.2968, val: 4 },
            { nome: "Volpago del Montello", lat: 45.7833, lon: 12.1167, val: 1 },
            { nome: "Pasiano di Pordenone", lat: 45.8500, lon: 12.6333, val: 1 },
            { nome: "Trevignano", lat: 45.7333, lon: 12.0667, val: 6 },
            { nome: "San Stino di Livenza", lat: 45.7333, lon: 12.6833, val: 4 },
            { nome: "Scorzè", lat: 45.5667, lon: 12.1167, val: 7 },
            { nome: "San Fior", lat: 45.9167, lon: 12.3667, val: 2 },
            { nome: "Torre di Mosto", lat: 45.6833, lon: 12.7167, val: 1 },
            { nome: "Jesolo", lat: 45.5337, lon: 12.6416, val: 8 },
            { nome: "Eraclea", lat: 45.5833, lon: 12.6833, val: 1 },
            { nome: "Brugnera", lat: 45.9333, lon: 12.5333, val: 2 },
            { nome: "Prata di Pordenone", lat: 45.8833, lon: 12.5833, val: 3 },
            { nome: "Salzano", lat: 45.5333, lon: 12.1167, val: 5 },
            { nome: "Cavallino-Treporti", lat: 45.4542, lon: 12.4542, val: 13 },
            { nome: "Montebelluna", lat: 45.7758, lon: 12.0464, val: 7 },
            { nome: "Venezia", lat: 45.4408, lon: 12.3155, val: 7 },
            { nome: "Pieve di Soligo", lat: 45.9000, lon: 12.1667, val: 1 },
            { nome: "Spinea", lat: 45.5000, lon: 12.1667, val: 1 },
            { nome: "Trebaseleghe", lat: 45.6000, lon: 12.0500, val: 2 },
            { nome: "Vedelago", lat: 45.6833, lon: 12.0167, val: 10 },
            { nome: "Noale", lat: 45.5500, lon: 12.0667, val: 2 },
            { nome: "Colle Umberto", lat: 45.9500, lon: 12.3500, val: 1 },
            { nome: "Cordignano", lat: 45.9469, lon: 12.4136, val: 9 },
            { nome: "Sacile", lat: 45.9500, lon: 12.5000, val: 3 },
            { nome: "Mirano", lat: 45.5000, lon: 12.1167, val: 3 },
            { nome: "Pramaggiore", lat: 45.8167, lon: 12.7333, val: 1 },
            { nome: "Refrontolo", lat: 45.9167, lon: 12.2000, val: 2 },
            { nome: "Cappella Maggiore", lat: 45.9667, lon: 12.3667, val: 1 },
            { nome: "Caneva", lat: 45.9667, lon: 12.4500, val: 2 },
            { nome: "Crocetta del Montello", lat: 45.8333, lon: 12.0500, val: 1 },
            { nome: "Piombino Dese", lat: 45.6000, lon: 12.0000, val: 3 },
            { nome: "Farra di Soligo", lat: 45.9000, lon: 12.1000, val: 5 },
            { nome: "Caerano di San Marco", lat: 45.7833, lon: 12.0000, val: 2 },
            { nome: "Fregona", lat: 46.0000, lon: 12.3333, val: 1 },
            { nome: "Tarzo", lat: 45.9667, lon: 12.2333, val: 1 },
            { nome: "Vittorio Veneto", lat: 45.9833, lon: 12.3000, val: 3 },
            { nome: "Massanzago", lat: 45.5667, lon: 12.0000, val: 1 },
            { nome: "Azzano Decimo", lat: 45.8833, lon: 12.7000, val: 1 },
            { nome: "Cornuda", lat: 45.8333, lon: 12.0000, val: 1 },
            { nome: "Fontanafredda", lat: 45.9667, lon: 12.5667, val: 3 },
            { nome: "Altivole", lat: 45.7500, lon: 11.9500, val: 2 },
            { nome: "Resana", lat: 45.6333, lon: 11.9500, val: 6 },
            { nome: "Santa Maria di Sala", lat: 45.5000, lon: 12.0333, val: 8 },
            { nome: "Mira", lat: 45.4333, lon: 12.1333, val: 1 },
            { nome: "Castelfranco Veneto", lat: 45.6714, lon: 11.9344, val: 5 },
            { nome: "Porcia", lat: 45.9667, lon: 12.6167, val: 1 },
            { nome: "Riese Pio X", lat: 45.7333, lon: 11.9167, val: 6 },
            { nome: "Concordia Sagittaria", lat: 45.7500, lon: 12.8333, val: 1 },
            { nome: "Camposampiero", lat: 45.5667, lon: 11.9333, val: 1 },
            { nome: "Valdobbiadene", lat: 45.9000, lon: 11.9333, val: 1 },
            { nome: "Borgoricco", lat: 45.5333, lon
            { nome: "Pianiga", lat: 45.4667, lon: 12.0333, val: 4 },
            { nome: "Fiume Veneto", lat: 45.9333, lon: 12.7333, val: 1 },
            { nome: "Asolo", lat: 45.8000, lon: 11.9167, val: 3 },
            { nome: "Castello di Godego", lat: 45.6833, lon: 11.8833, val: 6 },
            { nome: "Pederobba", lat: 45.8833, lon: 11.9500, val: 3 },
            { nome: "Santa Giustina in Colle", lat: 45.5667, lon: 11.9000, val: 1 },
            { nome: "Caorle", lat: 45.6000, lon: 12.8833, val: 2 },
            { nome: "San Martino di Lupari", lat: 45.6500, lon: 11.8500, val: 4 },
            { nome: "Loria", lat: 45.7303, lon: 11.8647, val: 16 },
            { nome: "Vigonza", lat: 45.4414, lon: 11.9833, val: 2 },
            { nome: "Campodarsego", lat: 45.5000, lon: 11.9167, val: 1 },
            { nome: "Camponogara", lat: 45.3833, lon: 12.0667, val: 5 },
            { nome: "Castelcucco", lat: 45.8333, lon: 11.8833, val: 2 },
            { nome: "Galliera Veneta", lat: 45.6667, lon: 11.8333, val: 2 },
            { nome: "San Vito al Tagliamento", lat: 45.9167, lon: 12.8500, val: 1 },
            { nome: "San Zenone degli Ezzelini", lat: 45.7833, lon: 11.8333, val: 5 },
            { nome: "Noventa Padovana", lat: 45.4167, lon: 11.9500, val: 1 },
            { nome: "Rossano Veneto", lat: 45.7000, lon: 11.8000, val: 2 },
            { nome: "Vigonovo", lat: 45.3833, lon: 12.0000, val: 4 },
            { nome: "Vigodarzere", lat: 45.4667, lon: 11.8833, val: 2 },
            { nome: "Limana", lat: 46.1000, lon: 12.1833, val: 1 },
            { nome: "Cittadella", lat: 45.6486, lon: 11.7833, val: 6 },
            { nome: "San Giorgio in Bosco", lat: 45.5833, lon: 11.8000, val: 1 },
            { nome: "Curtarolo", lat: 45.5167, lon: 11.8333, val: 1 },
            { nome: "Saonara", lat: 45.3689, lon: 11.9793, val: 13 },
            { nome: "San Michele al Tagliamento", lat: 45.6667, lon: 13.0000, val: 2 },
            { nome: "Campolongo Maggiore", lat: 45.3333, lon: 12.0500, val: 5 },
            { nome: "Latisana", lat: 45.7833, lon: 13.0000, val: 1 },
            { nome: "Fontaniva", lat: 45.6333, lon: 11.7500, val: 1 },
            { nome: "Legnaro", lat: 45.3500, lon: 11.9667, val: 1 },
            { nome: "Piazzola sul Brenta", lat: 45.5333, lon: 11.7833, val: 1 },
            { nome: "Padova", lat: 45.4064, lon: 11.8768, val: 6 },
            { nome: "Villafranca Padovana", lat: 45.4833, lon: 11.7167, val: 1 },
            { nome: "Ponte San Nicolò", lat: 45.3667, lon: 11.9333, val: 1 },
            { nome: "Piove di Sacco", lat: 45.3000, lon: 12.0333, val: 2 },
            { nome: "Feltre", lat: 46.0167, lon: 11.9000, val: 5 },
            { nome: "Belluno", lat: 46.1333, lon: 12.2167, val: 4 },
            { nome: "Sedico", lat: 46.1167, lon: 12.1000, val: 5 },
            { nome: "Tezze sul Brenta", lat: 45.6833, lon: 11.7000, val: 1 },
            { nome: "Arzergrande", lat: 45.2833, lon: 12.0500, val: 1 },
            { nome: "Sant'Angelo di Piove di Sacco", lat: 45.3500, lon: 12.0000, val: 2 },
            { nome: "Albignasego", lat: 45.3500, lon: 11.8667, val: 1 },
            { nome: "Ponte nelle Alpi", lat: 46.1833, lon: 12.2833, val: 1 },
            { nome: "Mestrino", lat: 45.4500, lon: 11.7667, val: 1 },
            { nome: "Maserà di Padova", lat: 45.3167, lon: 11.8667, val: 2 },
            { nome: "Selvazzano Dentro", lat: 45.4000, lon: 11.7833, val: 1 },
            { nome: "Veggiano", lat: 45.4500, lon: 11.7000, val: 1 },
            { nome: "Bovolenta", lat: 45.2667, lon: 11.9333, val: 1 }
        ];

        // --- 4. DISEGNO PUNTI ---
        comuni.forEach(c => {
            let color, radius, opacity;

            if (c.tipo === "sede") {
                color = "#d32f2f"; radius = 14; opacity = 1;
            } else if (c.val >= 10) {
                color = "#1b5e20"; radius = 12; opacity = 0.8;
            } else if (c.val >= 3) {
                color = "#4caf50"; radius = 8; opacity = 0.7;
            } else {
                color = "#bdbdbd"; radius = 5; opacity = 0.6;
            }

            L.circleMarker([c.lat, c.lon], {
                radius: radius,
                fillColor: color,
                color: "#fff",
                weight: 1,
                opacity: 1,
                fillOpacity: opacity
            }).addTo(map)
            .bindPopup(`<div style="text-align:center"><b>${c.nome}</b><br>Contatti: ${c.val}</div>`);
        });

    </script>
</body>
</html>
